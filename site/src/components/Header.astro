---
export interface Props {
  logoSrc?: string;
  brandName?: string;
}

const nav = [
  { href: "/", label: "Accueil" },
  { href: "/notre-histoire", label: "Notre histoire" },
  { href: "/nos-produits", label: "Nos produits" },
  { href: "/evenements", label: "Événements" },

  // Social proof / B2B
  { href: "/references", label: "Références" },

  { href: "/contact", label: "Contact / collaboration" },

  // Utility (keep, but lower visual weight on desktop)
  { href: "/evenements#prochaines-dates", label: "Nous trouver", cta: true },
];

const { logoSrc = "/images/logo.png", brandName = "Usagi Délice" } = Astro.props;
---

<header class="site-header" data-header>
  <div class="container header-inner header-inner--responsive">
    <a class="brand" href="/" aria-label={`${brandName} — Accueil`}>
      <img
        src={logoSrc}
        alt={`${brandName} logo`}
        width="48"
        height="48"
        loading="eager"
      />
      <span class="name">{brandName}</span>
    </a>

    <nav class="nav" aria-label="Navigation principale">
      {nav.map((item) => (
        <a href={item.href} class={item.cta ? "nav-cta" : undefined}>
          {item.label}
        </a>
      ))}
    </nav>

    <div class="header-actions">
      <button
        class="menu-btn"
        type="button"
        aria-label="Ouvrir le menu"
        aria-expanded="false"
        aria-controls="mobile-drawer"
        data-menu-btn
      >
        <span class="burger" aria-hidden="true"><i></i><i></i><i></i></span>
      </button>
    </div>
  </div>

  <div class="mobile-drawer" id="mobile-drawer" data-mobile-drawer>
    <div class="container" role="menu" aria-label="Menu mobile">
      {nav.map((item) => (
        <a href={item.href} role="menuitem" class={item.cta ? "mobile-cta" : undefined}>
          {item.label}
        </a>
      ))}
    </div>
  </div>
</header>

<script is:inline>
  (() => {
    const btn = document.querySelector("[data-menu-btn]");
    const drawer = document.querySelector("[data-mobile-drawer]");
    if (!(btn instanceof HTMLButtonElement) || !(drawer instanceof HTMLElement)) return;

    const setOpen = (open) => {
      drawer.style.display = open ? "block" : "none";
      btn.setAttribute("aria-expanded", open ? "true" : "false");
    };

    const isOpen = () => drawer.style.display === "block";

    setOpen(false);

    btn.addEventListener("click", (e) => {
      e.preventDefault();
      setOpen(!isOpen());
    });

    drawer.querySelectorAll("a").forEach((a) => {
      a.addEventListener("click", () => setOpen(false));
    });

    document.addEventListener("click", (e) => {
      if (!isOpen()) return;
      const t = e.target;
      if (t instanceof Node && (drawer.contains(t) || btn.contains(t))) return;
      setOpen(false);
    });

    window.addEventListener(
      "scroll",
      () => {
        if (isOpen()) setOpen(false);
      },
      { passive: true }
    );

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") setOpen(false);
    });
  })();
</script>

<style>
  .mobile-drawer { display: none; }

  .site-header { position: sticky; top: 0; }

  /* "Nous trouver" CTA — subtle on desktop */
  .nav-cta {
    padding: 8px 12px;
    border-radius: 999px;
    border: 1px solid rgba(42, 31, 31, 0.14);
    background: rgba(255, 255, 255, 0.25);
  }
  .nav-cta:hover { background: rgba(255, 255, 255, 0.4); }

  @media (min-width: 980px) {
    .nav-cta { margin-left: 6px; }
  }

  /* Mobile drawer: make "Nous trouver" more obvious */
  .mobile-cta { font-weight: 900; }
</style>
